{{#partial "contenido"}}

<link href="css/dataTables.bootstrap4.min.css" rel="stylesheet">
<script src="js/jquery.dataTables.min.js" type="text/javascript"></script>
<script src="js/dataTables.bootstrap4.min.js" type="text/javascript"></script>

<select class="form-control" id="cmbComuna">
	<option value="">Mostrar todas las comunas</option>
	{{#each comuna}}
	<option value="{{numero}} - {{nombre}}">{{numero}} - {{nombre}}</option>
	{{/each}}
</select>

<br>

<table class="table table-striped table-bordered" id="tablaTerminales">
	<thead>
		<tr>
			<th>Nombre de la Terminal</th>
			<th>Comuna</th>
			<th>Ubicación</th>
			<th>Acciones</th>
		</tr>
	</thead>
	<tbody>
		{{#each terminal}}
		<tr>
			<td>{{nombre}}</td>
			<td>{{comuna.numero}} - {{comuna.nombre}}</td>
			<td><a href="https://www.google.com/maps?q=loc:{{coordenadas.longitud}},{{coordenadas.latitud}}">{{coordenadas.longitud}};{{coordenadas.latitud}}</a></td>
			<td class="text-center">
				<button type="button" class="btn btn-warning" title="Modificar terminal" data-toggle="modal" data-id="{{id}}" data-nombre="{{nombre}}"
                        data-longitud="{{coordenadas.longitud}}" data-latitud="{{coordenadas.latitud}}" data-comuna="{{comuna.numero}}" data-target="#modalModificarTerminal">
					<span class="glyphicon glyphicon-pencil"></span>
				</button>
				<button type="button" class="btn btn-info" title="Configurar acciones de la terminal">
					<span class="glyphicon glyphicon-cog"></span>
				</button>
                <button type="button" class="btn btn-danger" title="Eliminar terminal" data-toggle="modal" data-id="{{id}}" data-target="#modalEliminarTerminal">
                    <span class="glyphicon glyphicon-remove"></span>
                </button>
			</td>
		</tr>
		{{/each}}
	</tbody>
</table>

<button type="button" id="btnNuevaTerminal" class="btn btn-primary" data-toggle="modal" data-target="#modalNuevaTerminal"><span class="glyphicon glyphicon-plus"></span></button>

<div class="modal fade" id="modalNuevaTerminal" tabindex="-1" role="dialog" data-keyboard="false" data-backdrop="static">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Nueva Terminal</h4>
			</div>
			<div class="modal-body">
				<form class="form-horizontal" action="nuevaTerminal" method="POST">
					<div class="form-group">
						<label class="control-label col-sm-2" for="modalTxtNombre">Nombre:</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" id="modalTxtNombre" placeholder="Ingrese un Nombre" name="nombre" required>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-2" for="modalCmbComuna">Comuna:</label>
						<div class="col-sm-10">
							<select class="form-control" id="modalCmbComuna" name="comuna">
								{{#each comuna}}
								<option value="{{numero}}">{{numero}} - {{nombre}}</option>
								{{/each}}
							</select>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-2" for="modalTxtLongitud">Longitud:</label>
						<div class="col-sm-10">
							<input type="number" step="any" class="form-control" id="modalTxtLongitud" placeholder="(Ejemplo: 43.0001)" name="longitud" required>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-2" for="modalTxtLatitud">Latitud:</label>
						<div class="col-sm-10">
							<input type="number" step="any" class="form-control" id="modalTxtLatitud" placeholder="(Ejemplo: 34.0002)" name="latitud" required>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-danger btn-lg" data-dismiss="modal">Cancelar</button>
						<button type="submit" class="btn btn-success btn-lg">Guardar</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="modalModificarTerminal" tabindex="-1" role="dialog" data-keyboard="false" data-backdrop="static">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Modificar Terminal</h4>
			</div>
			<div class="modal-body">
				<form class="form-horizontal" action="modificarTerminal" method="POST">
				    <input type="hidden" name="id" id="terminalAModificar">
					<div class="form-group">
						<label class="control-label col-sm-2" for="modalModificarTxtNombre">Nombre:</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" id="modalModificarTxtNombre" placeholder="Ingrese un Nombre" name="nombre" required>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-2" for="modalModificarCmbComuna">Comuna:</label>
						<div class="col-sm-10">
							<select class="form-control" id="modalModificarCmbComuna" name="comuna">
								{{#each comuna}}
								<option value="{{numero}}">{{numero}} - {{nombre}}</option>
								{{/each}}
							</select>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-2" for="modalModificarTxtLongitud">Longitud:</label>
						<div class="col-sm-10">
							<input type="number" step="any" class="form-control" id="modalModificarTxtLongitud" placeholder="(Ejemplo: 43.0001)" name="longitud" required>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-2" for="modalModificarTxtLatitud">Latitud:</label>
						<div class="col-sm-10">
							<input type="number" step="any" class="form-control" id="modalModificarTxtLatitud" placeholder="(Ejemplo: 34.0002)" name="latitud" required>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-danger btn-lg" data-dismiss="modal">Cancelar</button>
						<button type="submit" class="btn btn-success btn-lg">Guardar</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>



<div class="modal fade" id="modalEliminarTerminal" tabindex="-1" role="dialog" data-keyboard="false" data-backdrop="static">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Confirmar decisión</h4>
			</div>
			<form class="form-horizontal" action="eliminarTerminal" method="POST">
				<input type="hidden" name="id" id="terminalAEliminar">
				<div class="modal-body">
					¿Está seguro que desea eliminar esta terminal?
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger btn-lg" data-dismiss="modal">No</button>
					<button type="submit" class="btn btn-success btn-lg">Sí</button>
				</div>
			</form>
		</div>
	</div>
</div>

<script type="text/javascript"> 
	$(document).ready(function() {
	   $("#tablaTerminales").DataTable({
	    	"language": {
			    "sProcessing":     "Procesando...",
			    "sLengthMenu":     "Mostrar _MENU_ terminales",
			    "sZeroRecords":    "No se encontraron terminales",
			    "sEmptyTable":     "No se encontraron terminales",
			    "sInfo":           "Mostrando terminales del _START_ al _END_ de un total de _TOTAL_ terminales",
			    "sInfoEmpty":      "Mostrando terminales del 0 al 0 de un total de 0 terminales",
			    "sInfoFiltered":   "(filtrado de un total de _MAX_ terminales)",
			    "sInfoPostFix":    "",
			    "sSearch":         "Buscar:",
			    "sUrl":            "",
			    "sInfoThousands":  ",",
			    "sLoadingRecords": "Cargando...",
			    "oPaginate": {
			        "sFirst":    "Primero",
			        "sLast":     "Último",
			        "sNext":     "Siguiente",
			        "sPrevious": "Anterior"
			    },
			    "oAria": {
			        "sSortAscending":  ": Activar para ordenar la columna de manera ascendente",
			        "sSortDescending": ": Activar para ordenar la columna de manera descendente"
			    }
			}
	    });
	});
	
	$("#cmbComuna").on("change", function() {
		$("#tablaTerminales").DataTable().columns(1).search($("#cmbComuna option:selected").val()).draw();
	});
	
	$("#modalEliminarTerminal").on("show.bs.modal", function(event) {
		$("#terminalAEliminar").val(event.relatedTarget.dataset.id);
	});

    $("#modalModificarTerminal").on("show.bs.modal", function(event) {
        var terminalSeleccionada = event.relatedTarget.dataset;
        $("#terminalAModificar").val(terminalSeleccionada.id);
        $("#modalModificarTxtNombre").val(terminalSeleccionada.nombre);
        $("#modalModificarTxtLongitud").val(terminalSeleccionada.longitud);
        $("#modalModificarTxtLatitud").val(terminalSeleccionada.latitud);
        $("#modalModificarCmbComuna").val(terminalSeleccionada.comuna);
    });
</script>

{{/partial}}

{{>PaginaBase.hbs}}